(this["webpackJsonpkloop-table"]=this["webpackJsonpkloop-table"]||[]).push([[0],{343:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=343},362:function(e,t,n){e.exports=n(442)},367:function(e,t,n){},442:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(16),c=n.n(r),l=(n(367),n(82)),s=n(83),i=n(87),u=n(86),m=n(74),d=n(26),f=n(130),h=n(154),p=n.n(h);p.a.initializeApp({apiKey:"AIzaSyCCAhvWFvwuxDUXZ4aV-FhB_Dj-lp_frCw",authDomain:"electionsmonitor-5d008.firebaseapp.com",databaseURL:"https://electionsmonitor-5d008.firebaseio.com",projectId:"electionsmonitor-5d008",storageBucket:"electionsmonitor-5d008.appspot.com",messagingSenderId:"145410178875",appId:"1:145410178875:web:6cf434df68d3c65062811e",measurementId:"G-EXC8T9QXES"});var b=new p.a.auth.GoogleAuthProvider,v=function(){p.a.auth().signInWithPopup(b)},E=p.a,w=o.a.createContext(),g=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(f.a)(n,2),c=r[0],l=r[1],s=Object(a.useState)(!0),i=Object(f.a)(s,2),u=i[0],m=i[1];return Object(a.useEffect)((function(){E.auth().onAuthStateChanged((function(e){l(e),m(!1)}))}),[]),u?o.a.createElement(o.a.Fragment,null,"Loading..."):o.a.createElement(w.Provider,{value:{currentUser:c}},t)},O=n(213),j=function(e){var t=e.component,n=Object(O.a)(e,["component"]),r=Object(a.useContext)(w).currentUser;return o.a.createElement(d.b,Object.assign({},n,{render:function(e){return r?o.a.createElement(t,e):o.a.createElement(d.a,{to:"/kloop-table/login"+window.location.search})}}))},y=n(252),k=n(354),S=n(147),_=n.n(S);function A(e){return o.a.createElement(_.a,{title:e.title,columns:e.columns,data:e.data,cellEditable:{onCellEditApproved:function(t,n,a,o){return new Promise((function(o,r){var c=Object.keys(a)[Object.values(a).indexOf(n)];e.save_role(a.id,c,t),setTimeout(o,1)}))}}})}var C=n(188),D=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={main_title:"",questions:[],columns:[],users:[],users_data:[],users_row:[],ready:!1},e.downloadData=function(t){var n=C.parse(window.location.search,{decode:!1});console.log(n),fetch(t).then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(t){console.log("DATA",t),e.setState({questions:t.questions,main_title:t.main_title}),e.columns(),E.firestore().collection("users").get().then((function(t){t.forEach((function(t){return e.state.users.push(t.id)}))})).then((function(){var t=E.firestore().collection("responses");e.state.users.forEach((function(n){t.doc(n).collection("answers").where("form_name","==",e.state.main_title).get().then((function(t){t.forEach((function(t,n){var a={},o=t.data();if(o){var r=Object.keys(e.state.columns),c=[];e.state.questions.forEach((function(e,t){if(o.answers[t]&&(console.log(e),console.log(o.answers[t])),"multiradio"===e.type)for(var n=e.subquestion.length,a=0;a<n;a++)o.answers[t]&&o.answers[t][a]?c.push(o.answers[t][a]):c.push("-");else o.answers[t]?c.push(o.answers[t]):c.push("-")})),console.log(c),r.forEach((function(e){c[e]?a[e]=c[e]:a[e]="-"}));var l=Object(k.a)(e.state.users_row);l.push(a),e.setState({users_row:l}),console.log(l)}}))}))}))}))}))},e}return Object(s.a)(n,[{key:"columns",value:function(){var e=[];this.state.questions.forEach((function(t,n){"multiradio"===t.type?t.subquestion.forEach((function(t){return e.push({title:t.q,editable:"never"})})):e.push({title:t.title,editable:"never"})}));var t=e.map((function(e,t){return Object(y.a)(Object(y.a)({},e),{},{field:t})}));console.log(t),this.setState({columns:t})}},{key:"componentDidMount",value:function(){this.downloadData(this.props.url)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement("button",{onClick:function(){return e.setState({ready:!0})}},"Set ready"),this.state.ready?o.a.createElement(A,{columns:this.state.columns,title:this.state.main_title,data:this.state.users_row}):null)}}]),n}(a.Component),x=n(188),N=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={tablets:[],data:[],columns:[],users:[],users_by_column:{}},e.downloadData=function(){var t=x.parse(window.location.search,{decode:!1});console.log(t),fetch("https://raw.githubusercontent.com/KloopMedia/ElectionsMonitoringFormsConfig/master/config_v2.json").then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(t){console.log("DATA",t),e.setState({tablets:t})}))},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.downloadData()}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(m.a,null,this.state.tablets.map((function(e,t){return o.a.createElement("li",{key:t},o.a.createElement(m.b,{to:"/kloop-table/tablets"+e.path+window.location.search},e.label))})),o.a.createElement(d.d,null,this.state.tablets.map((function(e,t){return o.a.createElement(d.b,{key:t,path:"/kloop-table/tablets"+e.path},(function(){return o.a.createElement(D,{url:e.url,label:e.label})}))})))))}}]),n}(a.Component),T=n(155),q=n.n(T),M=n(319),P={ok:o.a.createElement(q.a,{style:{color:"#4BB543"}}),ok_no_data:o.a.createElement(q.a,{style:{color:"grey"}}),notice:o.a.createElement(q.a,{style:{color:"#fddb3a"}}),warning:o.a.createElement(q.a,{style:{color:"red"}})},R={},F={},I=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={data:[],columns:[],ready:!1},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this;E.database().ref().child("users_tests").child("users").on("value",(function(t){var n=Object.values(t.val());n.forEach((function(e){R[e.name]=e.name,F[e.email]=e.email}));var a=n.map((function(e){Object.keys(e.tests).forEach((function(t,n){e[t]=e.tests[t]}));e.tests;var t=Object(O.a)(e,["tests"]);return console.log(t),t})),r=Object.keys(a[0]).map((function(e){var t=P;return"name"===e?t=R:"email"===e&&(t=F),{title:e,field:e,render:function(t){return t[e].status?t[e].description?o.a.createElement(M.a,{title:t[e].description,arrow:!0},P[t[e].status]):P[t[e].status]:t[e]},customFilterAndSearch:function(t,n){return n[e].status?-1!==n[e].status.indexOf(t):-1!==n[e].indexOf(t)},lookup:t}}));e.setState({data:a}),e.setState({columns:r}),e.setState({ready:!0}),console.log(r),console.log(e.state.data)}))}},{key:"render",value:function(){return this.state.ready?o.a.createElement("div",{style:{maxWidth:"100%"}},o.a.createElement(_.a,{columns:this.state.columns,data:this.state.data,options:{filtering:!0,padding:"dense"},title:"Kloop Table"})):null}}]),n}(a.Component),U=n(193),B=n(188),W=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={data:[],columns:[]},e.downloadData=function(){var t=B.parse(window.location.search,{decode:!1});console.log(t),fetch("https://raw.githubusercontent.com/Kabirov7/kloop-forms-test/master/kloop-table/config.json").then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(t){console.log("DATA",t),e.setState({columns:t.fields.mainAdminTable})}))},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.downloadData(),E.firestore().collection("users").onSnapshot((function(t){var n=[],a=[];t.docs.map((function(e,t){n.push(e.data()),a.push(e.id)}));var o=[];n.forEach((function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t]})),n.id=a[t],o[t]=n})),e.setState({data:o})}))}},{key:"save_role",value:function(e,t,n){E.firestore().collection("users").doc("".concat(e)).update(Object(U.a)({},t,n))}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(A,{columns:this.state.columns,data:this.state.data,save_role:this.save_role}))}}]),n}(a.Component),K=n(188),L=function(){var e=Object(a.useState)([]),t=Object(f.a)(e,2),n=(t[0],t[1]),r=Object(a.useState)(""),c=Object(f.a)(r,2),l=(c[0],c[1]);return Object(a.useEffect)((function(){var e=K.parse(window.location.search);console.log(e),l(e.url),e.url?fetch(e.url).then((function(e){return console.log("RESPONSE",e),e.json()})).then((function(e){console.log("DATA",e),n(e)})):console.log("ERROR: no url detected")}),[]),o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,"Home"),o.a.createElement("button",{onClick:function(){return E.auth().signOut()}},"Sign out"),o.a.createElement(m.a,null,o.a.createElement("div",null,o.a.createElement("nav",null,o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement(m.b,{to:"/kloop-table/tablets"+window.location.search},"\u0424\u043e\u0440\u043c\u044b")),o.a.createElement("li",null,o.a.createElement(m.b,{to:"/kloop-table/admin"+window.location.search},"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u0410\u0442\u0430\u044f")),o.a.createElement("li",null,o.a.createElement(m.b,{to:"/kloop-table/admin-role"+window.location.search},"\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u044e\u0437\u0435\u0440\u043e\u0432 \u0441 \u0440\u043e\u043b\u044f\u043c\u0438")))),o.a.createElement(d.d,null,o.a.createElement(d.b,{exact:!0,path:"/kloop-table/tablets",component:N}),o.a.createElement(d.b,{exact:!0,path:"/kloop-table/admin",component:I}),o.a.createElement(d.b,{exact:!0,path:"/kloop-table/admin-role",component:W})))))},G=Object(d.g)((function(e){e.history;return Object(a.useContext)(w).currentUser?o.a.createElement(d.a,{to:"/kloop-table/"+window.location.search}):o.a.createElement("div",null,o.a.createElement("h1",null,"Log in"),o.a.createElement("button",{onClick:v},"Sign-in with Google"))})),X=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return o.a.createElement(g,null,o.a.createElement("div",{className:"App"},o.a.createElement(m.a,null,o.a.createElement(j,{exact:!0,path:"/kloop-table/",component:L}),o.a.createElement(d.b,{exact:!0,path:"/kloop-table/login",component:G}))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[362,1,2]]]);
//# sourceMappingURL=main.65430199.chunk.js.map